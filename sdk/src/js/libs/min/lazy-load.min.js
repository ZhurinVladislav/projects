const loadImg = () => {
  const arrIframe = [...Array.from(document.querySelectorAll('iframe'))];
  const arrAllImg = [...Array.from(document.querySelectorAll('img'))];
  const arrImgAndIframe = [...arrIframe, ...arrAllImg];

  const arrBgImg = [...Array.from(document.querySelectorAll('[data-image]'))];
  const arrAttrImg = [...Array.from(document.querySelectorAll('img[data-src]'))];

  const widthWindow = document.documentElement.clientWidth;

  if (arrBgImg) {
    arrBgImg.forEach(el => {
      const srcImg = el.getAttribute('data-image');
      const srcImgSm = el.getAttribute('data-image-sm');
      const srcImgPh = el.getAttribute('data-image-ph');

      if (widthWindow > 991) {
        el.style.backgroundImage = `url(${srcImg})`;
        if (srcImgSm) el.removeAttribute('data-image-sm');
        if (srcImgPh) el.removeAttribute('data-image-ph');
        el.removeAttribute('data-image');
      } else if (widthWindow > 767 && widthWindow <= 991) {
        if (srcImgSm) {
          el.style.backgroundImage = `url(${srcImgSm})`;
        } else if (srcImgPh) {
          el.style.backgroundImage = `url(${srcImgPh})`;
        } else {
          el.style.backgroundImage = `url(${srcImg})`;
        }

        el.removeAttribute('data-image');
        if (srcImgSm) el.removeAttribute('data-image-sm');
        if (srcImgPh) el.removeAttribute('data-image-ph');
      } else if (widthWindow <= 767) {
        if (srcImgPh) {
          el.style.backgroundImage = `url(${srcImgPh})`;
        } else if (srcImgSm) {
          el.style.backgroundImage = `url(${srcImgSm})`;
        } else {
          el.style.backgroundImage = `url(${srcImg})`;
        }
        el.removeAttribute('data-image');
        if (srcImgSm) el.removeAttribute('data-image-sm');
        if (srcImgPh) el.removeAttribute('data-image-ph');
      }
    });
  }

  if (arrAttrImg) {
    arrAttrImg.forEach(el => {
      if (el.dataset.src) el.src = el.dataset.src;

      el.removeAttribute('data-src');
    });
  }

  if (arrImgAndIframe) {
    arrImgAndIframe.forEach(el => {
      el.setAttribute('loading', 'lazy');
    });
  }
};

window.addEventListener('load', loadImg);
